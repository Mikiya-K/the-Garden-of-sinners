<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zemic.training.repository.DevCustomerRepository">

	<insert id="add"  parameterType="com.zemic.training.entity.DevCustomer" >
		INSERT INTO [DevCustomer] 
		(Id, name, type, status, email, phone, manager, CreatedTime, IsDeleted) 
		VALUES
		(#{id, typeHandler=com.zemic.training.common.UUIDTypeHandler},
		 #{name}, #{type}, #{status}, #{email}, #{phone}, #{manager}, #{createdTime}, #{isDeleted})
	</insert>

	<update id="update"  parameterType="com.zemic.training.entity.DevCustomer">
		UPDATE [DevCustomer]
	 SET name=#{name},
		 type=#{type}, 
		 status=#{status}, 
		 email=#{email},
		 phone=#{phone},
		 manager=#{manager}, 
         LastModifiedTime=#{lastModifiedTime}, 
         IsDeleted=#{isDeleted}
		WHERE Id = #{id, typeHandler=com.zemic.training.common.UUIDTypeHandler}
	</update>

	<update id="delete">
		UPDATE [DevCustomer] SET
		isDeleted = 1
		WHERE Id = #{id, typeHandler=com.zemic.training.common.UUIDTypeHandler}
	</update>

	<select id="get" resultType="com.zemic.training.entity.DevCustomer">
		SELECT * FROM [DevCustomer] WHERE Id= #{id, typeHandler=com.zemic.training.common.UUIDTypeHandler} AND IsDeleted='false'
	</select>

	<select id="getByPage" resultType="com.zemic.training.entity.DevCustomer">
		SELECT *
        FROM
            (
                SELECT row_number()
                OVER (ORDER BY CreatedTime DESC)  As rownumber, [DevCustomer].*
                FROM [DevCustomer]
                WHERE IsDeleted='false'
                <if test="name != null and name != ''">
                    AND name LIKE #{name}
                </if>
                <if test="type != null and type != ''">
                    AND type LIKE #{type}
                </if>
                <if test="status != null and status != ''">
                    AND status LIKE #{status}
                </if>
                <if test="manager != null and manager != ''">
                    AND manager LIKE #{manager}
                </if>
            ) AS result
        WHERE rownumber &gt;=#{startNumber}
        AND rownumber &lt;=#{endNumber}
	</select>
	
	<select id="queryCountForPage" resultType="java.lang.Integer">
		SELECT count(1) from [DevCustomer]
        WHERE IsDeleted='false'
                <if test="name != null and name != ''">
                    AND name LIKE #{name}
                </if>
                <if test="type != null and type != ''">
                    AND type LIKE #{type}
                </if>
                <if test="status != null and status != ''">
                    AND status LIKE #{status}
                </if>
                <if test="manager != null and manager != ''">
                    AND manager LIKE #{manager}
                </if>
	</select>


</mapper>