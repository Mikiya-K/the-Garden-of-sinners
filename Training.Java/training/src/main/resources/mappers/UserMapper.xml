<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zemic.training.repository.UserRepository">

	<insert id="add"  parameterType="com.zemic.training.entity.User" >
		INSERT INTO [User] 
		(Id, Name, LoginName, Password, CreatedTime, IsDeleted) 
		VALUES
		(#{id, typeHandler=com.zemic.training.common.UUIDTypeHandler},
		 #{name}, #{loginName}, #{password}, #{createdTime}, #{isDeleted})
	</insert>

	<update id="update"  parameterType="com.zemic.training.entity.User">
		UPDATE [User]
		SET Name=#{name},
		 LoginName=#{loginName}, 
		 Password=#{password}, 
		 AuthenticationToken=#{authenticationToken}, 
         LastLoginTime=#{lastLoginTime}, 
         LastModifiedTime=#{lastModifiedTime}, 
         IsDeleted=#{isDeleted}
		WHERE Id = #{id, typeHandler=com.zemic.training.common.UUIDTypeHandler}
	</update>

	<update id="delete">
		UPDATE [User] SET
		isDeleted = 1
		WHERE Id = #{id, typeHandler=com.zemic.training.common.UUIDTypeHandler}
	</update>

	<select id="get" resultType="com.zemic.training.entity.User">
		SELECT * FROM [User] WHERE Id= #{id, typeHandler=com.zemic.training.common.UUIDTypeHandler} AND IsDeleted='false'
	</select>

	<select id="getByPage" resultType="com.zemic.training.entity.User">
		SELECT *
        FROM
            (
                SELECT row_number()
                OVER (ORDER BY CreatedTime DESC)  As rownumber, [User].*
                FROM [User]
                WHERE IsDeleted='false'
                <if test="name != null and name != ''">
                    AND Name LIKE #{name}
                </if>
                <if test="loginName != null and loginName != ''">
                    AND LoginName = #{loginName}
                </if>
            ) AS result
        WHERE rownumber &gt;=#{startNumber}
        AND rownumber &lt;=#{endNumber}
	</select>
	
	<select id="queryCountForPage" resultType="java.lang.Integer">
		SELECT count(1) from [User]
        WHERE IsDeleted='false'
        <if test="name != null and name != ''">
           AND Name LIKE #{name}
        </if>
        <if test="loginName != null and loginName != ''">
           AND LoginName = #{loginName}
        </if>
	</select>

	<select id="getByLoginName"  resultType="com.zemic.training.entity.User">
		SELECT * FROM [User] WHERE LoginName=#{loginName} AND IsDeleted=0
	</select>

	<select id="getByAuthenticationToken" resultType="com.zemic.training.entity.User">
		SELECT * FROM [User] WHERE AuthenticationToken=#{authenticationToken} AND IsDeleted=0
	</select>
</mapper>